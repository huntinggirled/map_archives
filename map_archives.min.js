(function(a){a("#header").css("position","relative");a("#footer").css("position","relative");a("body").append('<div id="screennavi"><div id="navitab"><a href="" onclick="$(\'#screennavi\').tabToggle();return false;">\u25c7 \u9589\u3058\u308b</a></div><div id="marker_div"><img src="img/indi.gif" alt="\u8aad\u307f\u8fbc\u307f\u4e2d..." width="10" height="10" /> \u8aad\u307f\u8fbc\u307f\u4e2d...</div><div id="sort_div"><input id="sort1" type="radio" name="sort" onchange="$(\'#map_archives\').markerToggle();return false;" checked><a href="" onclick="$(\'#map_archives\').sortToggle();return false;">\u6642\u9593\u9806</a> <input id="sort2" type="radio" name="sort" onchange="$(\'#map_archives\').markerToggle();return false;"><a href="" onclick="$(\'#map_archives\').sortToggle();return false;">\u8ddd\u96e2\u9806</a></div><div id="search_div"><input id="search_button" type="button" value="\u5468\u8fba\u3092\u518d\u691c\u7d22" onclick="$(\'#map_archives\').markerToggle();return false;" disabled="disabled" /></div><div id="polyline_div"><input id="polyline" type="checkbox" onchange="$(\'#map_archives\').polylineToggle();return false;"> <a href="" onclick="document.getElementById(\'polyline\').checked=(document.getElementById(\'polyline\').checked)?false:true;$(\'#map_archives\').polylineToggle();return false;">\u30dd\u30ea\u30e9\u30a4\u30f3\u8868\u793a</a></div><div id="current_div"><input id="current_button" type="button" value="\u73fe\u5728\u5730\u306b\u79fb\u52d5" onclick="$(\'#map_archives\').getCurrentPosition();return false;"></div><div><input id="screen" type="checkbox" onchange="$(\'#map_archives\').screenToggle();return false;"> <a href="" onclick="document.getElementById(\'screen\').checked=(document.getElementById(\'screen\').checked)?false:true;$(\'#map_archives\').screenToggle();return false;">\u5168\u753b\u9762\u8868\u793a</a></div></div>');
a("#sort_div").hide();a("#search_div").hide();a("#polyline_div").hide();a("#sidenavi").css("position","fixed").css("background","#cccccc").css("padding","5px").css("top","50%").css("right","0px").css("z-index","2000").css("opacity","0.9").css("filter","alpha(opacity=90)");a("#screennavi").css("position","fixed").css("background","#cccccc").css("padding","5px").css("bottom","0px").css("right","0px").css("z-index","2000").css("opacity","0.9").css("filter","alpha(opacity=90)");var f=a("#map_archives"),
x={zoom:13,center:new google.maps.LatLng(35.681597,139.766092),disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.ROADMAP},m=new google.maps.Map(document.getElementById("map_archives"),x),t=new google.maps.Polyline({path:new google.maps.MVCArray,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2});t.setMap(m);var y=0,s=new google.maps.InfoWindow,n=new google.maps.Marker,d=new google.maps.MVCArray,u=new google.maps.MVCArray,v={width:f.css("width"),height:f.css("height"),zindex:f.css("z-index")},
l="0-0",g=void 0,w=[];a("body").keydown(function(c){(c=a("#seq_marker").attr("seq")||void 0)&&(37===event.which?f.slideMarker(++c):39===event.which&&f.slideMarker(--c))});a.ajax({url:"<$mt:BlogURL$>archives_jsonp.php",dataType:"jsonp",callback:"callback",timeout:5E3}).done(function(a,b,g){w=a;f.loadMarker()}).fail(function(c,b,g){a("#marker_div").empty()}).always(function(a,b,g){});a.fn.loadMarker=function(){var c=w.items,b=[],d=void 0,f=void 0;if(location.search)for(var e=location.search,e=e.substring(1,
e.length),k=[],k=e.split("&"),e=0;e<k.length;e++){var h=[],h=k[e].split("="),r=h[1];if("q"==h[0]&&""!=r){f=new google.maps.LatLng(r.split(",")[0],r.split(",")[1]);g||(l="3-3");break}}a("#sort1").is(":checked")?c.sort(function(a,c){return a.datetime<c.datetime?1:-1}):c.sort(function(a,c){var b=m.getCenter(),d=b.lat(),e=b.lng(),b=e-a.lng,b=Math.sqrt(Math.pow(d-a.lat,2)+Math.pow(b,2)),e=e-c.lng,d=Math.sqrt(Math.pow(d-c.lat,2)+Math.pow(e,2));return b-d});for(e=k=0;e<c.length;e++)if(h=c[e],""!=h.lat&&
""!=h.lng){var r=h.datetime.split(" ")[0].replace(/-0/g,"-")+" "+h.title,p=h.datetime.split("-")[0]+"-"+h.datetime.split("-")[1];b[p]=+b[p]||0;b[p]++;var q='<div id="seq_marker" seq="'+k+'" style="height:80px; width:200px; overflow:auto;">',q=q+('<div>[ <a href="" onclick="$(this).slideMarker('+(k+1)+');return false;">\u2190</a> ] [ <a href="" onclick="$(this).slideMarker('+(k-1)+');return false;">\u2192</a> ]</div>'),q=q+('<a href="'+h.link+'" target="_blank"><img class="widget-img-thumb" src="'+
h.thumbnail+'" height="45" width="45" alt="'+r+'" title="'+r+'" /></a>'),q=q+('<a href="'+h.link+'" target="_blank">'+h.title+"</a><br />"),q=q+"</div>";!l||"0-0"!=l&&"4-4"!=l&&"1-1"!=l&&l!=p&&"3-3"!=l||(p=new google.maps.LatLng(h.lat,h.lng),d||(d=p),"3-3"==l?f.lat()==p.lat()&&f.lng()==p.lng()&&(a.createMarker(p,r,q,k++),1!=k||g||(a("title").append(": "+h.title),a(".archive-header").append(": "+h.title))):"0-0"==l&&10<=e||"4-4"==l&&100<=e||a.createMarker(p,r,q,k++))}m.panTo(d);a(this).focus();if(!g){"3-3"==
l&&0<k-1&&(a("title").append(" \u4ed6"+(k-1)+"\u4ef6"),a(".archive-header").append(" \u4ed6"+(k-1)+"\u4ef6"));var c="",d=0,n;for(n in b)e=n.replace("-0","-"),c+='<option value="'+n+'">'+e.split("-")[0]+"\u5e74"+e.split("-")[1]+"\u6708\uff08"+b[n]+"\uff09</option>",d+=b[n];g="";g+='<select onchange="$(this).markerToggle(this[this.selectedIndex].value);return false;">';f&&(g+='<option value="3-3">\u30ea\u30f3\u30af\u5730\u70b9</option>');g+='<option value="0-0">\u76f4\u8fd110\u4ef6</option>';g+='<option value="4-4">\u76f4\u8fd1100\u4ef6</option>';
g+=c;g+='<option value="1-1">\u5168\u30de\u30fc\u30af\uff08'+d+'\uff09</option><option value="2-2">\u5168\u3066\u524a\u9664</option></select>';a("#marker_div").empty().append(g)}l&&"3-3"==l?(f&&a.directMarker(f),a("#sort_div").hide("fast"),a("#search_div").hide("fast"),a("#polyline_div").hide("fast")):(a("#sort_div").show("fast"),a("#search_div").show("fast"),a("#polyline_div").show("fast"))};a.createMarker=function(c,b,f,g){var e=new google.maps.Marker({position:c,map:m,title:b,zIndex:g}),k=new google.maps.InfoWindow({content:f,
zIndex:1E4});google.maps.event.addListener(e,"click",function(){s.close();if(n.getPosition()&&n.getPosition().equals(e.getPosition())&&n.getPosition().equals(e.getPosition()))return n=new google.maps.Marker,!1;k.open(m,e);s=k;n=e;a("#marker_div select").blur()});a("#polyline").is(":checked")&&t.getPath().insertAt(y++,c);d.push(e);u.push(k)};a.fn.sortToggle=function(){a("#sort1").is(":checked")?(a("#sort2").prop("checked",!0),a("#search_button").attr("disabled",!1),a("#search_button").removeAttr("disabled")):
(a("#sort1").prop("checked",!0),a("#search_button").attr("disabled",!0));a(this).markerToggle()};a.fn.markerToggle=function(c){c&&(l=c);d.forEach(function(a,c){a.setMap(null)});d.clear();u.clear();t.getPath().clear();"2-2"!=l&&a(this).loadMarker()};a.fn.polylineToggle=function(){if(a("#polyline").is(":checked")){0>=d.getLength()&&a(this).loadMarker();for(var c=0;c<d.getLength();c++){var b=d.getAt(c).getPosition();t.getPath().insertAt(c+1,b)}}else t.getPath().clear()};a.fn.screenToggle=function(){if(a("#screen").is(":checked")){var c=
m.getCenter();f.css("position","fixed");f.css("top","0px");f.css("left","0px");f.css("width","100%");f.css("height","100%")}else c=m.getCenter(),f.css("position","relative"),f.css("width",v.width),f.css("height",v.height);google.maps.event.trigger(m,"resize");m.panTo(c)};a.fn.tabToggle=function(){"0px"==a("#screennavi").css("right")?(a("#screennavi").animate({right:"-"+(a("#screennavi").width()-50)+"px",bottom:"-"+(a("#screennavi").height()-17)+"px"},200),a("#navitab a").text("\u25c6 \u958b\u304f")):
(a("#screennavi").animate({right:"0px",bottom:"0px"},200),a("#navitab a").text("\u25c7 \u9589\u3058\u308b"))};a.fn.slideMarker=function(a){var b=d.getAt(0).getZIndex(),f=d.getAt(d.length-1).getZIndex();a<b?a=f:f<a&&(a=b);for(b=0;b<d.length;b++)if(d.getAt(b).getZIndex()==a){s.close();a=d.getAt(b);b=u.getAt(b);b.open(m,a);m.panTo(a.getPosition());s=b;n=a;break}};a.directMarker=function(a){for(var b=0;b<d.length;b++)if(d.getAt(b).getPosition().lat()==a.lat()&&d.getAt(b).getPosition().lng()==a.lng()){s.close();
a=d.getAt(b);b=u.getAt(b);b.open(m,a);m.panTo(a.getPosition());s=b;n=a;break}};a.fn.getCurrentPosition=function(){a("#current_button").attr("disabled",!0);a("#current_div").append(' <img src="img/indi.gif" alt="\u8aad\u307f\u8fbc\u307f\u4e2d..." width="10" height="10" />');navigator.geolocation?navigator.geolocation.getCurrentPosition(function(c){c=new google.maps.LatLng(c.coords.latitude,c.coords.longitude);m.panTo(c);a("#current_button").attr("disabled",!1);a("#current_button").removeAttr("disabled");
a("#current_div > img").remove()},function(){a("#current_button").attr("disabled",!1);a("#current_button").removeAttr("disabled");a("#current_div > img").remove()}):(a("#current_button").attr("disabled",!1),a("#current_button").removeAttr("disabled"),a("#current_div > img").remove())}})(jQuery);